/*[tplStatic 1.0 - 1510]*/

eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(m($){18 W=2v.4T,D=2v.4S,F=2v.4R,u=2v.4Q;m V(){C $("<4P/>")};$.N=m(T,c){18 O=$(T),1F,A=V(),1k=V(),I=V().r(V()).r(V()).r(V()),B=V().r(V()).r(V()).r(V()),E=$([]),1K,G,l,17={v:0,l:0},Q,M,1l,1g={v:0,l:0},12=0,1J="1H",2k,2j,1t,1s,S,1B,1A,2o,2n,14,1Q,a,b,j,g,f={a:0,b:0,j:0,g:0,H:0,L:0},2u=R.4O,1M=4N.4M,$p,d,i,o,w,h,2p;m 1n(x){C x+17.v-1g.v};m 1m(y){C y+17.l-1g.l};m 1b(x){C x-17.v+1g.v};m 1a(y){C y-17.l+1g.l};m 1z(3J){C 3J.4L-1g.v};m 1y(3I){C 3I.4K-1g.l};m 13(32){18 1i=32||1t,1h=32||1s;C{a:u(f.a*1i),b:u(f.b*1h),j:u(f.j*1i),g:u(f.g*1h),H:u(f.j*1i)-u(f.a*1i),L:u(f.g*1h)-u(f.b*1h)}};m 23(a,b,j,g,31){18 1i=31||1t,1h=31||1s;f={a:u(a/1i||0),b:u(b/1h||0),j:u(j/1i||0),g:u(g/1h||0)};f.H=f.j-f.a;f.L=f.g-f.b};m 1f(){9(!1F||!O.H()){C}17={v:u(O.2t().v),l:u(O.2t().l)};Q=O.2Y();M=O.3H();17.l+=(O.30()-M)>>1;17.v+=(O.2q()-Q)>>1;1B=u(c.4J/1t)||0;1A=u(c.4I/1s)||0;2o=u(F(c.4H/1t||1<<24,Q));2n=u(F(c.4G/1s||1<<24,M));9($().4F=="1.3.2"&&1J=="21"&&!2u["4E"]){17.l+=D(R.1q.2r,2u.2r);17.v+=D(R.1q.2s,2u.2s)}1g=/1H|4D/.1c(1l.q("1p"))?{v:u(1l.2t().v)-1l.2s(),l:u(1l.2t().l)-1l.2r()}:1J=="21"?{v:$(R).2s(),l:$(R).2r()}:{v:0,l:0};G=1n(0);l=1m(0);9(f.j>Q||f.g>M){1U()}};m 1V(3F){9(!1Q){C}A.q({v:1n(f.a),l:1m(f.b)}).r(1k).H(w=f.H).L(h=f.L);1k.r(I).r(E).q({v:0,l:0});I.H(D(w-I.2q()+I.2Y(),0)).L(D(h-I.30()+I.3H(),0));$(B[0]).q({v:G,l:l,H:f.a,L:M});$(B[1]).q({v:G+f.a,l:l,H:w,L:f.b});$(B[2]).q({v:G+f.j,l:l,H:Q-f.j,L:M});$(B[3]).q({v:G+f.a,l:l+f.g,H:w,L:M-f.g});w-=E.2q();h-=E.30();2O(E.3f){15 8:$(E[4]).q({v:w>>1});$(E[5]).q({v:w,l:h>>1});$(E[6]).q({v:w>>1,l:h});$(E[7]).q({l:h>>1});15 4:E.3G(1,3).q({v:w});E.3G(2,4).q({l:h})}9(3F!==Y){9($.N.2Z!=2R){$(R).U($.N.2z,$.N.2Z)}9(c.1T){$(R)[$.N.2z]($.N.2Z=2R)}}9(1j&&I.2q()-I.2Y()==2){I.q("3E",0);3x(m(){I.q("3E","4C")},0)}};m 22(3D){1f();1V(3D);a=1n(f.a);b=1m(f.b);j=1n(f.j);g=1m(f.g)};m 27(2X,2w){c.1P?2X.4B(c.1P,2w):2X.1r()};m 1d(2W){18 x=1b(1z(2W))-f.a,y=1a(1y(2W))-f.b;9(!2p){1f();2p=11;A.1G("4A",m(){2p=Y})}S="";9(c.2D){9(y<=c.1W){S="n"}X{9(y>=f.L-c.1W){S="s"}}9(x<=c.1W){S+="w"}X{9(x>=f.H-c.1W){S+="e"}}}A.q("2V",S?S+"-19":c.26?"4z":"");9(1K){1K.4y()}};m 2S(4x){$("1q").q("2V","");9(c.4w||f.H*f.L==0){27(A.r(B),m(){$(J).1r()})}$(R).U("P",2l);A.P(1d);c.2f(T,13())};m 2C(1X){9(1X.3z!=1){C Y}1f();9(S){$("1q").q("2V",S+"-19");a=1n(f[/w/.1c(S)?"j":"a"]);b=1m(f[/n/.1c(S)?"g":"b"]);$(R).P(2l).1G("1x",2S);A.U("P",1d)}X{9(c.26){2k=G+f.a-1z(1X);2j=l+f.b-1y(1X);A.U("P",1d);$(R).P(2T).1G("1x",m(){c.2f(T,13());$(R).U("P",2T);A.P(1d)})}X{O.1O(1X)}}C Y};m 1w(3C){9(14){9(3C){j=D(G,F(G+Q,a+W(g-b)*14*(j>a||-1)));g=u(D(l,F(l+M,b+W(j-a)/14*(g>b||-1))));j=u(j)}X{g=D(l,F(l+M,b+W(j-a)/14*(g>b||-1)));j=u(D(G,F(G+Q,a+W(g-b)*14*(j>a||-1))));g=u(g)}}};m 1U(){a=F(a,G+Q);b=F(b,l+M);9(W(j-a)<1B){j=a-1B*(j<a||-1);9(j<G){a=G+1B}X{9(j>G+Q){a=G+Q-1B}}}9(W(g-b)<1A){g=b-1A*(g<b||-1);9(g<l){b=l+1A}X{9(g>l+M){b=l+M-1A}}}j=D(G,F(j,G+Q));g=D(l,F(g,l+M));1w(W(j-a)<W(g-b)*14);9(W(j-a)>2o){j=a-2o*(j<a||-1);1w()}9(W(g-b)>2n){g=b-2n*(g<b||-1);1w(11)}f={a:1b(F(a,j)),j:1b(D(a,j)),b:1a(F(b,g)),g:1a(D(b,g)),H:W(j-a),L:W(g-b)};1V();c.2g(T,13())};m 2l(2U){j=/w|e|^$/.1c(S)||14?1z(2U):1n(f.j);g=/n|s|^$/.1c(S)||14?1y(2U):1m(f.g);1U();C Y};m 1v(3B,3A){j=(a=3B)+f.H;g=(b=3A)+f.L;$.2c(f,{a:1b(a),b:1a(b),j:1b(j),g:1a(g)});1V();c.2g(T,13())};m 2T(2m){a=D(G,F(2k+1z(2m),G+Q-f.H));b=D(l,F(2j+1y(2m),l+M-f.L));1v(a,b);2m.4v();C Y};m 2h(){$(R).U("P",2h);1f();j=a;g=b;1U();S="";9(!B.2y(":4u")){A.r(B).1r().2E(c.1P||0)}1Q=11;$(R).U("1x",1N).P(2l).1G("1x",2S);A.U("P",1d);c.3y(T,13())};m 1N(){$(R).U("P",2h).U("1x",1N);27(A.r(B));23(1b(a),1a(b),1b(a),1a(b));9(!(J 4t $.N)){c.2g(T,13());c.2f(T,13())}};m 2A(2i){9(2i.3z!=1||B.2y(":4s")){C Y}1f();2k=a=1z(2i);2j=b=1y(2i);$(R).P(2h).1x(1N);C Y};m 2B(){22(Y)};m 2x(){1F=11;25(c=$.2c({1S:"4r",26:11,20:"1q",2D:11,1W:10,3w:m(){},3y:m(){},2g:m(){},2f:m(){}},c));A.r(B).q({3b:""});9(c.2F){1Q=11;1f();1V();A.r(B).1r().2E(c.1P||0)}3x(m(){c.3w(T,13())},0)};18 2R=m(16){18 k=c.1T,d,t,2N=16.4q;d=!1L(k.2P)&&(16.2e||16.3t.2e)?k.2P:!1L(k.2a)&&16.3u?k.2a:!1L(k.2b)&&16.3v?k.2b:!1L(k.2Q)?k.2Q:10;9(k.2Q=="19"||(k.2b=="19"&&16.3v)||(k.2a=="19"&&16.3u)||(k.2P=="19"&&(16.2e||16.3t.2e))){2O(2N){15 37:d=-d;15 39:t=D(a,j);a=F(a,j);j=D(t+d,a);1w();1u;15 38:d=-d;15 40:t=D(b,g);b=F(b,g);g=D(t+d,b);1w(11);1u;3s:C}1U()}X{a=F(a,j);b=F(b,g);2O(2N){15 37:1v(D(a-d,G),b);1u;15 38:1v(a,D(b-d,l));1u;15 39:1v(a+F(d,Q-1b(j)),b);1u;15 40:1v(a,b+F(d,M-1a(g)));1u;3s:C}}C Y};m 1R(3r,2M){3p(18 2d 4p 2M){9(c[2d]!==1Y){3r.q(2M[2d],c[2d])}}};m 25(K){9(K.20){(1l=$(K.20)).2G(A.r(B))}$.2c(c,K);1f();9(K.2L!=3q){E.1o();E=$([]);i=K.2L?K.2L=="4o"?4:8:0;3g(i--){E=E.r(V())}E.29(c.1S+"-4n").q({1p:"1H",36:0,1I:12+1||1});9(!4m(E.q("H"))>=0){E.H(5).L(5)}9(o=c.2K){E.q({2K:o,2H:"3m"})}1R(E,{3n:"2J-28",3l:"2I-28",3o:"1e"})}1t=c.4l/Q||1;1s=c.4k/M||1;9(K.a!=3q){23(K.a,K.b,K.j,K.g);K.2F=!K.1r}9(K.1T){c.1T=$.2c({2b:1,2a:"19"},K.1T)}B.29(c.1S+"-4j");1k.29(c.1S+"-4i");3p(i=0;i++<4;){$(I[i-1]).29(c.1S+"-2J"+i)}1R(1k,{4h:"2I-28",4g:"1e"});1R(I,{3o:"1e",2K:"2J-H"});1R(B,{4f:"2I-28",4e:"1e"});9(o=c.3n){$(I[0]).q({2H:"3m",3k:o})}9(o=c.3l){$(I[1]).q({2H:"4d",3k:o})}A.2G(1k.r(I).r(1K)).2G(E);9(1j){9(o=(B.q("3j")||"").3i(/1e=(\\d+)/)){B.q("1e",o[1]/1Z)}9(o=(I.q("3j")||"").3i(/1e=(\\d+)/)){I.q("1e",o[1]/1Z)}}9(K.1r){27(A.r(B))}X{9(K.2F&&1F){1Q=11;A.r(B).2E(c.1P||0);22()}}14=(d=(c.4c||"").4b(/:/))[0]/d[1];O.r(B).U("1O",2A);9(c.1E||c.1D===Y){A.U("P",1d).U("1O",2C);$(3h).U("19",2B)}X{9(c.1D||c.1E===Y){9(c.2D||c.26){A.P(1d).1O(2C)}$(3h).19(2B)}9(!c.4a){O.r(B).1O(2A)}}c.1D=c.1E=1Y};J.1o=m(){25({1E:11});A.r(B).1o()};J.49=m(){C c};J.33=25;J.48=13;J.47=23;J.46=1N;J.45=22;18 1j=(/44 ([\\w.]+)/i.43(1M)||[])[1],3c=/42/i.1c(1M),3d=/41/i.1c(1M)&&!/3Z/i.1c(1M);$p=O;3g($p.3f){12=D(12,!1L($p.q("z-3e"))?$p.q("z-3e"):12);9($p.q("1p")=="21"){1J="21"}$p=$p.20(":3Y(1q)")}12=c.1I||12;9(1j){O.3X("3W","3V")}$.N.2z=1j||3d?"3U":"3T";9(3c){1K=V().q({H:"1Z%",L:"1Z%",1p:"1H",1I:12+2||2})}A.r(B).q({3b:"3a",1p:1J,3S:"3a",1I:12||"0"});A.q({1I:12+2||2});1k.r(I).q({1p:"1H",36:0});T.35||T.3R=="35"||!O.2y("3Q")?2x():O.1G("3P",2x);9(!1F&&1j&&1j>=7){T.34=T.34}};$.2w.N=m(Z){Z=Z||{};J.3O(m(){9($(J).1C("N")){9(Z.1o){$(J).1C("N").1o();$(J).3N("N")}X{$(J).1C("N").33(Z)}}X{9(!Z.1o){9(Z.1D===1Y&&Z.1E===1Y){Z.1D=11}$(J).1C("N",3M $.N(J,Z))}}});9(Z.3L){C $(J).1C("N")}C J}})(3K);',62,304,'|||||||||if|x1|y1|_7|||_23|y2|||x2||top|function||||css|add|||_4|left|||||_a|_d|return|_2|_e|_3|_10|width|_c|this|_55|height|_13|imgAreaSelect|_8|mousemove|_12|document|_1c|_6|unbind|_5|_1|else|false|_58||true|_16|_2c|_21|case|_50|_11|var|resize|_29|_28|test|_3a|opacity|_30|_15|sy|sx|_35|_b|_14|_27|_26|remove|position|body|hide|_1b|_1a|break|_45|_42|mouseup|evY|evX|_1e|_1d|data|enable|disable|_9|one|absolute|zIndex|_17|_f|isNaN|ua|_4a|mousedown|fadeSpeed|_22|_51|classPrefix|keys|_31|_32|resizeMargin|_40|undefined|100|parent|fixed|_36|_2e||_4f|movable|_38|color|addClass|ctrl|shift|extend|_54|altKey|onSelectEnd|onSelectChange|_49|_4c|_19|_18|_3e|_48|_20|_1f|_25|outerWidth|scrollTop|scrollLeft|offset|_24|Math|fn|_4e|is|keyPress|_4b|_4d|_3f|resizable|fadeIn|show|append|borderStyle|background|border|borderWidth|handles|_53|key|switch|alt|arrows|_34|_3c|_41|_44|cursor|_3b|_39|innerWidth|onKeyPress|outerHeight|_2f|_2d|setOptions|src|complete|fontSize||||hidden|visibility|_56|_57|index|length|while|window|match|filter|borderColor|borderColor2|solid|borderColor1|borderOpacity|for|null|_52|default|originalEvent|ctrlKey|shiftKey|onInit|setTimeout|onSelectStart|which|_47|_46|_43|_37|margin|_33|slice|innerHeight|_2b|_2a|jQuery|instance|new|removeData|each|load|img|readyState|overflow|keypress|keydown|on|unselectable|attr|not|chrome||webkit|opera|exec|msie|update|cancelSelection|setSelection|getSelection|getOptions|persistent|split|aspectRatio|dashed|outerOpacity|outerColor|selectionOpacity|selectionColor|selection|outer|imageHeight|imageWidth|parseInt|handle|corners|in|keyCode|imgareaselect|animated|instanceof|visible|preventDefault|autoHide|_3d|toggle|move|mouseout|fadeOut|auto|relative|getBoundingClientRect|jquery|maxHeight|maxWidth|minHeight|minWidth|pageY|pageX|userAgent|navigator|documentElement|div|round|min|max|abs'.split('|')));
(function($){$.extend({ms_DatePicker:function(options){var defaults={YearSelector:"#sel_year",MonthSelector:"#sel_month",DaySelector:"#sel_day",FirstText:"--",FirstValue:0};var opts=$.extend({},defaults,options);var $YearSelector=$(opts.YearSelector);var $MonthSelector=$(opts.MonthSelector);var $DaySelector=$(opts.DaySelector);var FirstText=opts.FirstText;var FirstValue=opts.FirstValue;var str="<option value=\""+FirstValue+"\">"+FirstText+"</option>";$YearSelector.html(str);$MonthSelector.html(str);$DaySelector.html(str);var yearNow=2025;var yearSel=$YearSelector.attr("rel");for(var i=yearNow;i>=2015;i--){var sed=yearSel==i?"selected":"";var yearStr="<option value=\""+i+"\" "+sed+">"+i+"</option>";$YearSelector.append(yearStr);}
var monthSel=$MonthSelector.attr("rel");for(var i=1;i<=12;i++){var sed=monthSel==i?"selected":"";var monthStr="<option value=\""+i+"\" "+sed+">"+i+"</option>";$MonthSelector.append(monthStr);}
function BuildDay(){if($YearSelector.val()==0||$MonthSelector.val()==0){$DaySelector.html(str);}else{$DaySelector.html(str);var year=parseInt($YearSelector.val());var month=parseInt($MonthSelector.val());var dayCount=0;switch(month){case 1:case 3:case 5:case 7:case 8:case 10:case 12:dayCount=31;break;case 4:case 6:case 9:case 11:dayCount=30;break;case 2:dayCount=28;if((year%4==0)&&(year%100!=0)||(year%400==0)){dayCount=29;}
break;default:break;}
var daySel=$DaySelector.attr("rel");for(var i=1;i<=dayCount;i++){var sed=daySel==i?"selected":"";var dayStr="<option value=\""+i+"\" "+sed+">"+i+"</option>";$DaySelector.append(dayStr);}}}
$MonthSelector.change(function(){BuildDay();});$YearSelector.change(function(){BuildDay();});if($DaySelector.attr("rel")!=""){BuildDay();}}});})(jQuery);;
$(document).ready(function(){initProjectReleasePage();initSubmit();if($('#descDetailEditor').length>0){setTimeout(function(){var descDetaiUE=UE.getEditor('descDetailEditor');setTimeout(function(){descDetaiUE.setContent($('#description').val());},500);},0);}
if($('#financingPlanEditor').length>0){setTimeout(function(){var financingPlanUE=UE.getEditor('financingPlanEditor');setTimeout(function(){financingPlanUE.setContent($('#financingplan').val());},500);},0);}});function initDateInput(){$.ms_DatePicker({YearSelector:".sel_year",MonthSelector:".sel_month",DaySelector:".sel_day"});}
function initSubmit(){$('.J-CreateProjectForm').on('submit',function(){var data_status=false;var current_step=getNum($(this).attr('action'))-1;if(current_step==1){data_status=judgeStep1Data();var desc_detail=UE.getEditor('descDetailEditor').getContent();var financing_plan_desc=UE.getEditor('financingPlanEditor').getContent();$(".J-description").val(desc_detail);$(".J-financingplan").val(financing_plan_desc);var area_ids='';$('.J-field .select').each(function(){area_ids+=$(this).data('id')+',';});$('#area_ids').val(area_ids);var img_url=$('#projectBasicImgPrev img').attr('src');$('.J-img').val(img_url);}
if(current_step==2){data_status=judgeStep2Data();}
if(current_step==3){data_status=judgeStep3Data();}
if(current_step==4){data_status=judgeStep4Data();}
if(current_step==5){data_status=judgeStep5Data();}
if(!data_status){return false;}
showLoading();return true;});$('#myProjectReleaseModel .C-J-confirm').click(function(){$('.J-isverify').val(1);$('.J-submit').click();$('#myProjectReleaseModel').modal('hide');})}
function setReturnNum(){$('.J-return-money').val(isNaN(parseFloat($('.J-return-money').val()))?1:parseFloat($('.J-return-money').val()));var min=parseFloat($('#invest-wrap').data('minfinancing'))*10000;var max=parseFloat($('#invest-wrap').data('maxfinancing'))*10000;var return_money=$('.J-return-money').val();var per=parseFloat(return_money);var return_min_num=min/per;var return_max_num=max/per;if(isNaN(return_money)||!return_money.length){$('.J-return-min-num').val(0);$('.J-return-max-num').val(0);}else{$('.J-return-min-num').val(return_min_num);$('.J-return-max-num').val(return_max_num);}}
function setInvestNumShow(){var investments=$('.investment-box');var total=0;var min=parseFloat($('#invest-wrap').data('minfinancing'))*10000;var max=parseFloat($('#invest-wrap').data('maxfinancing'))*10000;for(var i=0;i<investments.length;i++){var money=investments.eq(i).find('.J-return-money').val()?parseFloat(investments.eq(i).find('.J-return-money').val()):0;var num=investments.eq(i).find('.J-return-num').val()?parseInt(investments.eq(i).find('.J-return-num').val()):0;total+=money*num;}
var relax_min=min-total;var relax_max=max-total;if(relax_min>0){$('.J-invest-num-show').html('所有档位总计融资'+total+' 元，距最低计划融资额还差 <span class="warning">'+relax_min+'</span> 元。');return false}
if(!(relax_min>0)&&!(relax_max<0)){$('.J-invest-num-show').html('所有档位总计融资 '+total+' 元，满足计划的融资要求。');return true;}
if(relax_max<0){$('.J-invest-num-show').html('所有档位总计融资 '+total+' 元，超出最高计划融资额 <span class="warning">'+Math.abs(relax_max)+'</span> 元。');return false;}}
function checkConfirm(){var data_status=judgeStep5Data(),is_check=$('.J-checkbox').attr('checked');if(data_status){if(!is_check){$('.error-box').html('*请先同意条约').css('display','block');}else{$('.error-box').css('display','none');$('#myProjectReleaseModel').modal('show');}}}
function initSampleImgShow(){$('.J-short-desc').focus(function(){$('.J-short-desc-sample').show();})
$('.J-short-desc').blur(function(){$('.J-short-desc-sample').hide();})
$('.J-return-content').focus(function(){$(this).parent().parent().find('.J-short-return-sample').show();})
$('.J-return-content').blur(function(){$(this).parent().parent().find('.J-short-return-sample').hide();})}
function initProjectReleasePage(){initStepDescStatus();initSampleImgShow();setInvestmentBox();setGuyBox();initSelectField();select_investment_partner();basic_img_input();gift_img_input();partner_img_input();initDateInput();}
function initStepDescStatus(){var step_label=$('#steps');var current_step=parseInt(step_label.attr('data-currentstep'));var step_lis=step_label.find('li');step_lis.removeClass('current');for(var i=0;i<step_lis.length;i++){var step_num=getNum(step_lis.eq(i).attr('id'));if(!(step_num>current_step)){step_lis.eq(i).addClass('current');}}}
function basic_img_input(){$('.J-CreateProjectForm .J-img-select').click(function(){removeError('.J-img-select');$('#projectBasicImgInput').click();});$('#projectBasicImgCropModal .C-J-confirm').click(function(){var size=JSON.parse(localStorage.getItem('cropImgSize'));var primary_width=$("#projectBasicImgCropModal .image-box img").width();var sourseImg=new Image();sourseImg.src=$("#projectBasicImgCropModal .image-box img").attr('src');var R=sourseImg.width/primary_width;var canvas=$("#projectBasicImgCropModal .J-canvas")[0];var context=canvas.getContext("2d");context.drawImage(sourseImg,size.x1*R,size.y1*R,size.w*R,size.h*R,0,0,canvas.width,canvas.height);$('#projectBasicImgCropModal .C-J-cancel').click();$('#projectBasicImgPrev').html('');$('#projectBasicImgPrev').append("<a class='img-a J-img'><img src='"+canvas.toDataURL('image/jpeg',0.8)+"'/></a>");})}
function gift_img_input(){$('#giftImgCropModal .C-J-confirm').unbind('click').click(function(){var size=JSON.parse(localStorage.getItem('cropImgSize'));var primary_width=$("#giftImgCropModal .image-box img").width();var sourseImg=new Image();sourseImg.src=$("#giftImgCropModal .image-box img").attr('src');var R=sourseImg.width/primary_width;var canvas=$("#giftImgCropModal .J-canvas")[0];var context=canvas.getContext("2d");context.drawImage(sourseImg,size.x1*R,size.y1*R,size.w*R,size.h*R,0,0,canvas.width,canvas.height);$('#giftImgCropModal .C-J-cancel').click();var current_input_id=localStorage.getItem('currentGiftInputID');var tplHtml=tpl("modelImgInput",{src:canvas.toDataURL("image/jpeg",0.8),index:getNum(current_input_id)});$('#'+current_input_id).before(tplHtml);$('.J-CreateProjectForm .close').unbind('click').click(function(){$(this).parent().remove();});})}
function partner_img_input(){$('#partnerImgCropModal .C-J-confirm').unbind('click').click(function(){var size=JSON.parse(localStorage.getItem('cropImgSize'));var primary_width=$("#partnerImgCropModal .image-box img").width();var sourseImg=new Image();sourseImg.src=$("#partnerImgCropModal .image-box img").attr('src');var R=sourseImg.width/primary_width;var canvas=$("#partnerImgCropModal .J-canvas")[0];var context=canvas.getContext("2d");context.drawImage(sourseImg,size.x1*R,size.y1*R,size.w*R,size.h*R,0,0,canvas.width,canvas.height);$('#partnerImgCropModal .C-J-cancel').click();var current_input_id=localStorage.getItem('currentPartnerInputID');var input_num=getNum(current_input_id);$('.J-img-box-'+input_num).html('');var tplHtml=tpl("modelImgInput",{src:canvas.toDataURL("image/jpeg",0.8),index:input_num});$('.J-img-box-'+input_num).append(tplHtml);})}
function initSelectField(){$('.J-CreateProjectForm .J-field .status-flag').bind('click',function(){var selected_input=$('.J-CreateProjectForm .field .select');var is_selected=$(this).hasClass('select');removeError($('.J-field'));if(is_selected){if(selected_input.length==1){alertImg('最后一个不能删哦！');}else{$(this).removeClass('select');}}
if(!is_selected){if(selected_input.length>2){alertImg('最多只能选三个哦！');}else{$(this).addClass('select');}}});}
function select_investment_partner(){$('.J-CreateProjectForm .title .status-flag').unbind('click').bind('click',function(){var is_selected=$(this).hasClass('select');if(is_selected){$(this).removeClass('select');}
if(!is_selected){$(this).addClass('select');}});}
function click_delete_investment(){var investment_box=$('.investment-box');if(investment_box.length==1){alertImg('最后一个档位不可以删哦！');}
if(investment_box.length>1){investment_box.find('.action-btns').css('display','block');}}
function click_delete_partner(){var partner_box=$('.partner-box');if(partner_box.length==1){alertImg('最后一个小伙伴不可以删哦！');}
if(partner_box.length>1){partner_box.find('.action-btns').css('display','block');}}
function cancel_delete_investment(){$('.investment-box .action-btns').css('display','none');}
function cancel_delete_partner(){$('.partner-box .action-btns').css('display','none');}
function setInvestmentBox(){var investments=$('.investment-box');for(var i=0;i<investments.length;i++){var capital_num=num_to_capital(i+1);investments.eq(i).find('.J-invest-num').html(capital_num);}
$('.action-btns').css('display','none');$('.error-box').css('display','none');$('.J-return-question-mark').unbind('hover').hover(function(){$('.J-question-mark-content').css('display','block');},function(){$('.J-question-mark-content').css('display','none');});}
function setGuyBox(){var partners=$('.partner-box');partners.find('.partner-sample').css('display','none').eq(0).css('display','block');for(var i=0;i<partners.length;i++){var num=i+1;var capital_num=num_to_capital(num);partners.eq(i).find('.partner-num').html(capital_num);partners.eq(i).find('.img-prev-box').addClass('J-img-box-'+num);}
$('.action-btns').css('display','none');$('.error-box').css('display','none');}
function num_to_capital(n){var cnum=['零','一','二','三','四','五','六','七','八','九'];var s='';n=''+n;for(var i=0;i<n.length;i++){s+=cnum[parseInt(n.charAt(i))];}
return s;}
function cropBasicImg(o){var isIE=navigator.userAgent.indexOf('MSIE')>=0;if(!o.value.match(/.jpg|.gif|.png|.bmp/i)){alert('图片格式无效！');return false;}
if(isIE){$('#projectBasicImgCropModal .image-box img').attr('src',o.value);$('#projectBasicImgCropModal .preview-box img').attr('src',o.value);}
if(!isIE){var file=o.files[0];var reader=new FileReader();reader.onload=function(){var img=new Image();img.src=reader.result;setCropImgSize(img.width,img.height);$('#projectBasicImgCropModal .image-box img').attr('src',reader.result);$('#projectBasicImgCropModal .preview-box img').attr('src',reader.result);};reader.readAsDataURL(file);}
$('#projectBasicImgCropModal').modal('show');$('#projectBasicImgCropModal .image-box img').imgAreaSelect({aspectRatio:'54:30',handles:true,fadeSpeed:200,onSelectChange:basicImgPreview});reset_img_selector($('#projectBasicImgCropModal .image-box img'),150,83);$(o).replaceWith('<input style="display:none" type="file" id="projectBasicImgInput" onchange="cropBasicImg(this)" alt="projectBasicImgCropModal">');}
function basicImgPreview(img,selection){if(!selection.width||!selection.height)
return;var scaleX=150/selection.width;var scaleY=83/selection.height;$('#projectBasicImgCropModal .preview-box img').css({width:Math.round(scaleX*img.width),height:Math.round(scaleY*img.height),marginLeft:-Math.round(scaleX*selection.x1),marginTop:-Math.round(scaleY*selection.y1)});localStorage.setItem('cropImgSize',JSON.stringify({'x1':selection.x1,'y1':selection.y1,'w':selection.width,'h':selection.height}));}
function cropGiftImg(o){var isIE=navigator.userAgent.indexOf('MSIE')>=0;localStorage.setItem('currentGiftInputID',$(o).attr('id'));if(!o.value.match(/.jpg|.gif|.png|.bmp/i)){alert('图片格式无效！');return false;}
if(isIE){$('#giftImgCropModal .image-box img').attr('src',o.value);$('#giftImgCropModal .preview-box img').attr('src',o.value);}
if(!isIE){var file=o.files[0];var reader=new FileReader();reader.onload=function(){var img=new Image();img.src=reader.result;setCropImgSize(img.width,img.height);$('#giftImgCropModal .image-box img').attr('src',reader.result);$('#giftImgCropModal .preview-box img').attr('src',reader.result);};reader.readAsDataURL(file);}
$('#giftImgCropModal').modal('show');$('#giftImgCropModal .image-box img').imgAreaSelect({aspectRatio:'1:1',handles:true,fadeSpeed:20,onSelectChange:giftImgPreview});reset_img_selector($('#giftImgCropModal .image-box img'),100,100);var id=$(o).attr('id');$(o).replaceWith('<input type="file" class="img-input-file" onchange="cropGiftImg(this)" id="'+id+'">');}
function giftImgPreview(img,selection){if(!selection.width||!selection.height)
return;var scaleX=150/selection.width;var scaleY=150/selection.height;$('#giftImgCropModal .preview-box img').css({width:Math.round(scaleX*img.width),height:Math.round(scaleY*img.height),marginLeft:-Math.round(scaleX*selection.x1),marginTop:-Math.round(scaleY*selection.y1)});localStorage.setItem('cropImgSize',JSON.stringify({'x1':selection.x1,'y1':selection.y1,'w':selection.width,'h':selection.height}));}
function cropPartnerImg(o){var isIE=navigator.userAgent.indexOf('MSIE')>=0;var cropModal=$('#partnerImgCropModal');localStorage.setItem('currentPartnerInputID',$(o).attr('id'));if(!o.value.match(/.jpg|.gif|.png|.bmp/i)){alert('图片格式无效！');return false;}
if(isIE){cropModal.find('.image-box img').attr('src',o.value);cropModal.find('.preview-box img').attr('src',o.value);}
if(!isIE){var file=o.files[0];var reader=new FileReader();reader.onload=function(){var img=new Image();img.src=reader.result;setCropImgSize(img.width,img.height);cropModal.find('.image-box img').attr('src',reader.result);cropModal.find('.preview-box img').attr('src',reader.result);};reader.readAsDataURL(file);}
cropModal.modal('show');cropModal.find('.image-box img').imgAreaSelect({aspectRatio:'1:1',handles:true,fadeSpeed:20,onSelectChange:partnerImgPreview});reset_img_selector(cropModal.find('.image-box img'),100,100);var id=$(o).attr('id');$(o).replaceWith('<input type="file" class="img-input-file" onchange="cropPartnerImg(this)" id="'+id+'">');}
function partnerImgPreview(img,selection){if(!selection.width||!selection.height)
return;var scaleX=150/selection.width;var scaleY=150/selection.height;$('#partnerImgCropModal .preview-box img').css({width:Math.round(scaleX*img.width),height:Math.round(scaleY*img.height),marginLeft:-Math.round(scaleX*selection.x1),marginTop:-Math.round(scaleY*selection.y1)});localStorage.setItem('cropImgSize',JSON.stringify({'x1':selection.x1,'y1':selection.y1,'w':selection.width,'h':selection.height}));}
function judgeProjectName(input){if(checkProjectName(input.value)){removeError(input);}else{setError(input,'*请输入2-40位字符的名称');}}
function judgePersonalDesc(input){var text=input.value;if(!text.length){setError(input,'*请输入210个字符以内的简介')}
if(text.length){removeError(input);}}
function judgeCityInput(input){var city=input.value;if(city.length){removeError(input);}else{setError(input,'请输入城市');}}
function judgeStep1Data(){checkWordNum($('.J-short-desc')[0]);var project_name=$('.J-name').val(),project_company=$('.J-company-name').val(),project_short_desc=$('.J-short-desc').val(),desc_max_num=parseInt($('.J-short-desc').data('max')),desc_had_num=parseInt($('.J-had-input').html()),project_img=$('#projectBasicImgPrev img').attr('src'),project_city=$('.J-city').val(),project_website=$('.J-website-link').val(),project_ios=$('.J-iOS-link').val(),project_android=$('.J-Android-link').val(),project_fields=$('.J-field .select'),project_detail_desc=UE.getEditor('descDetailEditor').getContent(),financing_plan_desc=UE.getEditor('financingPlanEditor').getContent();if(!checkProjectName(project_name)){setError('.J-name','*请输入2-40个字符的名称');$('.J-name').focus();return false;}else{removeError('.J-name');}
if(!project_company.length){setError('.J-company-name','*请输入公司名称');$('.J-company-name').focus();return false;}else{removeError('.J-company-name');}
if(!project_short_desc.length||desc_had_num>desc_max_num){setError('.J-short-desc','*请输入不超过210个字符的简介');$('.J-short-desc').focus();return false;}else{removeError('.J-short-desc');}
if(!project_img.length){setError('.J-img-select','*请选择图片进行上传');$('.J-img-select').focus();return false;}else{removeError('.J-img-select');}
if(!project_city){setError('.J-city','*请输入城市');$('.J-city').focus();return false;}else{removeError('.J-city');}
if(project_website&&!judgeLinkUrl($('.J-website-link')[0])){$('.J-website-link').focus();return false;}
if(project_ios&&!judgeLinkUrl($('.J-iOS-link')[0])){$('.J-iOS-link').focus();return false;}
if(project_android&&!judgeLinkUrl($('.J-Android-link')[0])){$('.J-Android-link').focus();return false;}
if(!project_fields[0]){setError('.J-field','*请选择所属领域');$('.J-field').focus();return false;}else{removeError('.J-field');}
if(!project_detail_desc.length){$('.error-box').html("*请填写项目的详细介绍").css('display','block');var editor=UE.getEditor('descDetailEditor');editor.focus();setTimeout(function(){$('.error-box').css('display','none');},1500);return false;}else{$('.error-box').css('display','none');}
if(!financing_plan_desc.length){$('.error-box').html("*请填写项目的融资计划").css('display','block');var plan_editor=UE.getEditor('financingPlanEditor');plan_editor.focus();setTimeout(function(){$('.error-box').css('display','none');},1500);return false;}else{$('.error-box').css('display','none');}
return true;}
function judgeStep2Data(){var current_valuation=parseFloat($('.J-current-valuation').val()),val_min=parseFloat($('#valuationMin').val()),val_max=parseFloat($('#valuationMax').val()),deadline=parseFloat($('#deadline').val()),valuation=parseFloat($('#valuation').val());if(!current_valuation){setError('.J-current-valuation','*请输入大于0的数字');$('.J-current-valuation').focus();return false;}else{removeError('.J-current-valuation');}
if(!checkMoney(val_min)){setError('#valuationMin','*请输入大于0的数字');$('#valuationMin').focus();return false;}else{removeError('#valuationMin');}
if(valuation<val_max){setError('#valuationMax','*最大融资不能超过估值');$('#valuationMax').focus();return false;}else{removeError('#valuationMax');}
if(!checkMoney(val_max)){setError('#valuationMax','*请输入大于0的数字');$('#valuationMax').focus();return false;}else{removeError('#valuationMax');}
if(!(val_min<val_max)){setError('#valuationMax','*请输入大于最小融资的数字');$('#valuationMax').focus();return false;}else{removeError('#valuationMax');}
if(!checkPositiveInt(parseInt(deadline))||parseInt(deadline)>90){setError('#deadline','*不超过90天');$('#deadline').focus();return false;}
return true;}
function judgeStep3Data(){var investments=$('.investment-box');var data_status=false;for(var i=0;i<investments.length;i++){var return_money=investments.eq(i).find('.J-return-money').val(),has_return=investments.eq(i).find('.J-yes').hasClass('select'),return_content=investments.eq(i).find('.J-return-content').val(),return_time=investments.eq(i).find('.J-provideDate').val(),return_img=investments.eq(i).find('.gift-imgs .J-img'),max_num=investments.eq(i).find('.J-max-num').val();if(!checkMoney(return_money)){setObjError(investments.eq(i).find('.J-return-money'),'*请输入大于0的金额');investments.eq(i).find('.J-return-money').focus();return;}
if(!checkPositiveInt(max_num)){setObjError(investments.eq(i).find('.J-max-num'),'*请输入大于0的整数');investments.eq(i).find('.J-max-num').focus();return;}
if(has_return){if(!return_content){setError(investments.eq(i).find('.J-return-content'),'*请填写回报信息');investments.eq(i).find('.J-return-content').focus();return;}else{remove(investments.eq(i).find('.J-return-content'));}
if(!judgePositiveInt(investments.eq(i).find('.J-provideDate')[0])){setError(investments.eq(i).find('.J-provideDate'),'*请填写大于0的整数');investments.eq(i).find('.J-provideDate').focus();return;}else{investments.eq(i).find('.J-provideDate').val(parseInt(return_time));remove(investments.eq(i).find('.J-provideDate'));}
if(!return_img.length){setError(investments.eq(i).find('.J-gift-img-input'),'*请上传图片');investments.eq(i).find('.J-gift-img-input').focus();return;}else{remove(investments.eq(i).find('.J-gift-img-input'));}}
if(i==investments.length-1){$('.error-box').css('display','none');data_status=true;}}
return data_status;}
function judgeStep4Data(){var partners=$('.partner-box');var partner_data=false;for(var i=0;i<partners.length;i++){var name=partners.eq(i).find('.J-name').val(),position=partners.eq(i).find('.J-position').val(),partner_short_desc=partners.eq(i).find('.J-short-desc').val(),partner_img=partners.eq(i).find('.img-prev-box img').attr('src');if(!checkOnlyChineseOrEnlish(name)){setObjError(partners.eq(i).find('.J-name'),'*请输入英文/中文，不支持特殊字符');partners.eq(i).find('.J-name').focus();return false;}
if(!checkOnlyChineseOrEnlish(position)){setObjError(partners.eq(i).find('.J-position'),'*请输入英文/中文，不支持特殊字符');partners.eq(i).find('.J-position').focus();return false;}
if(!partner_short_desc.length){setObjError(partners.eq(i).find('.J-short-desc'),'*请输入英文/中文，不支持特殊字符');partners.eq(i).find('.J-short-desc').focus();return false;}
if(!partner_img){setObjError(partners.eq(i).find('.J-img-input'),'*请选择图片进行上传');partners.eq(i).find('.J-img-input').focus();return false;}
if(i==partners.length-1){partner_data=true;}}
return partner_data;}
function judgeStep5Data(){var financer_name=$('.J-name').val(),financer_phone=$('.J-phone').val(),financer_email=$('.J-email').val();if(!checkOnlyChineseOrEnlish(financer_name)){setError('.J-name','*请输入中文或英文字符，不允许特殊字符');$('.J-name').focus();return false;}
if(!checkPhone(financer_phone)){setError('.J-phone','*请输入正确的手机号码');$('.J-phone').focus();return false;}
if(!checkEmail(financer_email)){setError('.J-email','*请输入正确的邮箱地址');$('.J-email').focus();return false;}
return true;}
function judgeMinValuation(input){var min=input.value,max=$('#valuationMax').val();if(!checkMoney(min)){setError(input,'*请输入大于0的数字');return;}
removeError(input);}
function judgeMaxValuation(input){var max=input.value,min=$('#valuationMin').val(),valuation=$('#valuation').val();if(!checkMoney(max)){setError(input,'*请输入大于0的数字');return;}
if(checkMoney(max)&&checkMoney(min)&&min!=''&&parseInt(min)>parseInt(max)){setError(input,'*请输入大于最小融资的的值');return;}
if(parseInt(valuation)<parseInt(max)){setError(input,'*最大融资不能超过估值');return;}
removeError('#valuationMin');removeError(input);}
function judgeTime(input){var time=input.value;if(!checkPositiveInt(parseInt(time))||parseInt(time)>90){setError(input,'*不超过90天');}else{input.value=parseInt(time);removeError(input);}};