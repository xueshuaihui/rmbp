/*[tplStatic 1.0 - 1511]*/

eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(m($){18 W=2v.4T,D=2v.4S,F=2v.4R,u=2v.4Q;m V(){C $("<4P/>")};$.N=m(T,c){18 O=$(T),1F,A=V(),1k=V(),I=V().r(V()).r(V()).r(V()),B=V().r(V()).r(V()).r(V()),E=$([]),1K,G,l,17={v:0,l:0},Q,M,1l,1g={v:0,l:0},12=0,1J="1H",2k,2j,1t,1s,S,1B,1A,2o,2n,14,1Q,a,b,j,g,f={a:0,b:0,j:0,g:0,H:0,L:0},2u=R.4O,1M=4N.4M,$p,d,i,o,w,h,2p;m 1n(x){C x+17.v-1g.v};m 1m(y){C y+17.l-1g.l};m 1b(x){C x-17.v+1g.v};m 1a(y){C y-17.l+1g.l};m 1z(3J){C 3J.4L-1g.v};m 1y(3I){C 3I.4K-1g.l};m 13(32){18 1i=32||1t,1h=32||1s;C{a:u(f.a*1i),b:u(f.b*1h),j:u(f.j*1i),g:u(f.g*1h),H:u(f.j*1i)-u(f.a*1i),L:u(f.g*1h)-u(f.b*1h)}};m 23(a,b,j,g,31){18 1i=31||1t,1h=31||1s;f={a:u(a/1i||0),b:u(b/1h||0),j:u(j/1i||0),g:u(g/1h||0)};f.H=f.j-f.a;f.L=f.g-f.b};m 1f(){9(!1F||!O.H()){C}17={v:u(O.2t().v),l:u(O.2t().l)};Q=O.2Y();M=O.3H();17.l+=(O.30()-M)>>1;17.v+=(O.2q()-Q)>>1;1B=u(c.4J/1t)||0;1A=u(c.4I/1s)||0;2o=u(F(c.4H/1t||1<<24,Q));2n=u(F(c.4G/1s||1<<24,M));9($().4F=="1.3.2"&&1J=="21"&&!2u["4E"]){17.l+=D(R.1q.2r,2u.2r);17.v+=D(R.1q.2s,2u.2s)}1g=/1H|4D/.1c(1l.q("1p"))?{v:u(1l.2t().v)-1l.2s(),l:u(1l.2t().l)-1l.2r()}:1J=="21"?{v:$(R).2s(),l:$(R).2r()}:{v:0,l:0};G=1n(0);l=1m(0);9(f.j>Q||f.g>M){1U()}};m 1V(3F){9(!1Q){C}A.q({v:1n(f.a),l:1m(f.b)}).r(1k).H(w=f.H).L(h=f.L);1k.r(I).r(E).q({v:0,l:0});I.H(D(w-I.2q()+I.2Y(),0)).L(D(h-I.30()+I.3H(),0));$(B[0]).q({v:G,l:l,H:f.a,L:M});$(B[1]).q({v:G+f.a,l:l,H:w,L:f.b});$(B[2]).q({v:G+f.j,l:l,H:Q-f.j,L:M});$(B[3]).q({v:G+f.a,l:l+f.g,H:w,L:M-f.g});w-=E.2q();h-=E.30();2O(E.3f){15 8:$(E[4]).q({v:w>>1});$(E[5]).q({v:w,l:h>>1});$(E[6]).q({v:w>>1,l:h});$(E[7]).q({l:h>>1});15 4:E.3G(1,3).q({v:w});E.3G(2,4).q({l:h})}9(3F!==Y){9($.N.2Z!=2R){$(R).U($.N.2z,$.N.2Z)}9(c.1T){$(R)[$.N.2z]($.N.2Z=2R)}}9(1j&&I.2q()-I.2Y()==2){I.q("3E",0);3x(m(){I.q("3E","4C")},0)}};m 22(3D){1f();1V(3D);a=1n(f.a);b=1m(f.b);j=1n(f.j);g=1m(f.g)};m 27(2X,2w){c.1P?2X.4B(c.1P,2w):2X.1r()};m 1d(2W){18 x=1b(1z(2W))-f.a,y=1a(1y(2W))-f.b;9(!2p){1f();2p=11;A.1G("4A",m(){2p=Y})}S="";9(c.2D){9(y<=c.1W){S="n"}X{9(y>=f.L-c.1W){S="s"}}9(x<=c.1W){S+="w"}X{9(x>=f.H-c.1W){S+="e"}}}A.q("2V",S?S+"-19":c.26?"4z":"");9(1K){1K.4y()}};m 2S(4x){$("1q").q("2V","");9(c.4w||f.H*f.L==0){27(A.r(B),m(){$(J).1r()})}$(R).U("P",2l);A.P(1d);c.2f(T,13())};m 2C(1X){9(1X.3z!=1){C Y}1f();9(S){$("1q").q("2V",S+"-19");a=1n(f[/w/.1c(S)?"j":"a"]);b=1m(f[/n/.1c(S)?"g":"b"]);$(R).P(2l).1G("1x",2S);A.U("P",1d)}X{9(c.26){2k=G+f.a-1z(1X);2j=l+f.b-1y(1X);A.U("P",1d);$(R).P(2T).1G("1x",m(){c.2f(T,13());$(R).U("P",2T);A.P(1d)})}X{O.1O(1X)}}C Y};m 1w(3C){9(14){9(3C){j=D(G,F(G+Q,a+W(g-b)*14*(j>a||-1)));g=u(D(l,F(l+M,b+W(j-a)/14*(g>b||-1))));j=u(j)}X{g=D(l,F(l+M,b+W(j-a)/14*(g>b||-1)));j=u(D(G,F(G+Q,a+W(g-b)*14*(j>a||-1))));g=u(g)}}};m 1U(){a=F(a,G+Q);b=F(b,l+M);9(W(j-a)<1B){j=a-1B*(j<a||-1);9(j<G){a=G+1B}X{9(j>G+Q){a=G+Q-1B}}}9(W(g-b)<1A){g=b-1A*(g<b||-1);9(g<l){b=l+1A}X{9(g>l+M){b=l+M-1A}}}j=D(G,F(j,G+Q));g=D(l,F(g,l+M));1w(W(j-a)<W(g-b)*14);9(W(j-a)>2o){j=a-2o*(j<a||-1);1w()}9(W(g-b)>2n){g=b-2n*(g<b||-1);1w(11)}f={a:1b(F(a,j)),j:1b(D(a,j)),b:1a(F(b,g)),g:1a(D(b,g)),H:W(j-a),L:W(g-b)};1V();c.2g(T,13())};m 2l(2U){j=/w|e|^$/.1c(S)||14?1z(2U):1n(f.j);g=/n|s|^$/.1c(S)||14?1y(2U):1m(f.g);1U();C Y};m 1v(3B,3A){j=(a=3B)+f.H;g=(b=3A)+f.L;$.2c(f,{a:1b(a),b:1a(b),j:1b(j),g:1a(g)});1V();c.2g(T,13())};m 2T(2m){a=D(G,F(2k+1z(2m),G+Q-f.H));b=D(l,F(2j+1y(2m),l+M-f.L));1v(a,b);2m.4v();C Y};m 2h(){$(R).U("P",2h);1f();j=a;g=b;1U();S="";9(!B.2y(":4u")){A.r(B).1r().2E(c.1P||0)}1Q=11;$(R).U("1x",1N).P(2l).1G("1x",2S);A.U("P",1d);c.3y(T,13())};m 1N(){$(R).U("P",2h).U("1x",1N);27(A.r(B));23(1b(a),1a(b),1b(a),1a(b));9(!(J 4t $.N)){c.2g(T,13());c.2f(T,13())}};m 2A(2i){9(2i.3z!=1||B.2y(":4s")){C Y}1f();2k=a=1z(2i);2j=b=1y(2i);$(R).P(2h).1x(1N);C Y};m 2B(){22(Y)};m 2x(){1F=11;25(c=$.2c({1S:"4r",26:11,20:"1q",2D:11,1W:10,3w:m(){},3y:m(){},2g:m(){},2f:m(){}},c));A.r(B).q({3b:""});9(c.2F){1Q=11;1f();1V();A.r(B).1r().2E(c.1P||0)}3x(m(){c.3w(T,13())},0)};18 2R=m(16){18 k=c.1T,d,t,2N=16.4q;d=!1L(k.2P)&&(16.2e||16.3t.2e)?k.2P:!1L(k.2a)&&16.3u?k.2a:!1L(k.2b)&&16.3v?k.2b:!1L(k.2Q)?k.2Q:10;9(k.2Q=="19"||(k.2b=="19"&&16.3v)||(k.2a=="19"&&16.3u)||(k.2P=="19"&&(16.2e||16.3t.2e))){2O(2N){15 37:d=-d;15 39:t=D(a,j);a=F(a,j);j=D(t+d,a);1w();1u;15 38:d=-d;15 40:t=D(b,g);b=F(b,g);g=D(t+d,b);1w(11);1u;3s:C}1U()}X{a=F(a,j);b=F(b,g);2O(2N){15 37:1v(D(a-d,G),b);1u;15 38:1v(a,D(b-d,l));1u;15 39:1v(a+F(d,Q-1b(j)),b);1u;15 40:1v(a,b+F(d,M-1a(g)));1u;3s:C}}C Y};m 1R(3r,2M){3p(18 2d 4p 2M){9(c[2d]!==1Y){3r.q(2M[2d],c[2d])}}};m 25(K){9(K.20){(1l=$(K.20)).2G(A.r(B))}$.2c(c,K);1f();9(K.2L!=3q){E.1o();E=$([]);i=K.2L?K.2L=="4o"?4:8:0;3g(i--){E=E.r(V())}E.29(c.1S+"-4n").q({1p:"1H",36:0,1I:12+1||1});9(!4m(E.q("H"))>=0){E.H(5).L(5)}9(o=c.2K){E.q({2K:o,2H:"3m"})}1R(E,{3n:"2J-28",3l:"2I-28",3o:"1e"})}1t=c.4l/Q||1;1s=c.4k/M||1;9(K.a!=3q){23(K.a,K.b,K.j,K.g);K.2F=!K.1r}9(K.1T){c.1T=$.2c({2b:1,2a:"19"},K.1T)}B.29(c.1S+"-4j");1k.29(c.1S+"-4i");3p(i=0;i++<4;){$(I[i-1]).29(c.1S+"-2J"+i)}1R(1k,{4h:"2I-28",4g:"1e"});1R(I,{3o:"1e",2K:"2J-H"});1R(B,{4f:"2I-28",4e:"1e"});9(o=c.3n){$(I[0]).q({2H:"3m",3k:o})}9(o=c.3l){$(I[1]).q({2H:"4d",3k:o})}A.2G(1k.r(I).r(1K)).2G(E);9(1j){9(o=(B.q("3j")||"").3i(/1e=(\\d+)/)){B.q("1e",o[1]/1Z)}9(o=(I.q("3j")||"").3i(/1e=(\\d+)/)){I.q("1e",o[1]/1Z)}}9(K.1r){27(A.r(B))}X{9(K.2F&&1F){1Q=11;A.r(B).2E(c.1P||0);22()}}14=(d=(c.4c||"").4b(/:/))[0]/d[1];O.r(B).U("1O",2A);9(c.1E||c.1D===Y){A.U("P",1d).U("1O",2C);$(3h).U("19",2B)}X{9(c.1D||c.1E===Y){9(c.2D||c.26){A.P(1d).1O(2C)}$(3h).19(2B)}9(!c.4a){O.r(B).1O(2A)}}c.1D=c.1E=1Y};J.1o=m(){25({1E:11});A.r(B).1o()};J.49=m(){C c};J.33=25;J.48=13;J.47=23;J.46=1N;J.45=22;18 1j=(/44 ([\\w.]+)/i.43(1M)||[])[1],3c=/42/i.1c(1M),3d=/41/i.1c(1M)&&!/3Z/i.1c(1M);$p=O;3g($p.3f){12=D(12,!1L($p.q("z-3e"))?$p.q("z-3e"):12);9($p.q("1p")=="21"){1J="21"}$p=$p.20(":3Y(1q)")}12=c.1I||12;9(1j){O.3X("3W","3V")}$.N.2z=1j||3d?"3U":"3T";9(3c){1K=V().q({H:"1Z%",L:"1Z%",1p:"1H",1I:12+2||2})}A.r(B).q({3b:"3a",1p:1J,3S:"3a",1I:12||"0"});A.q({1I:12+2||2});1k.r(I).q({1p:"1H",36:0});T.35||T.3R=="35"||!O.2y("3Q")?2x():O.1G("3P",2x);9(!1F&&1j&&1j>=7){T.34=T.34}};$.2w.N=m(Z){Z=Z||{};J.3O(m(){9($(J).1C("N")){9(Z.1o){$(J).1C("N").1o();$(J).3N("N")}X{$(J).1C("N").33(Z)}}X{9(!Z.1o){9(Z.1D===1Y&&Z.1E===1Y){Z.1D=11}$(J).1C("N",3M $.N(J,Z))}}});9(Z.3L){C $(J).1C("N")}C J}})(3K);',62,304,'|||||||||if|x1|y1|_7|||_23|y2|||x2||top|function||||css|add|||_4|left|||||_a|_d|return|_2|_e|_3|_10|width|_c|this|_55|height|_13|imgAreaSelect|_8|mousemove|_12|document|_1c|_6|unbind|_5|_1|else|false|_58||true|_16|_2c|_21|case|_50|_11|var|resize|_29|_28|test|_3a|opacity|_30|_15|sy|sx|_35|_b|_14|_27|_26|remove|position|body|hide|_1b|_1a|break|_45|_42|mouseup|evY|evX|_1e|_1d|data|enable|disable|_9|one|absolute|zIndex|_17|_f|isNaN|ua|_4a|mousedown|fadeSpeed|_22|_51|classPrefix|keys|_31|_32|resizeMargin|_40|undefined|100|parent|fixed|_36|_2e||_4f|movable|_38|color|addClass|ctrl|shift|extend|_54|altKey|onSelectEnd|onSelectChange|_49|_4c|_19|_18|_3e|_48|_20|_1f|_25|outerWidth|scrollTop|scrollLeft|offset|_24|Math|fn|_4e|is|keyPress|_4b|_4d|_3f|resizable|fadeIn|show|append|borderStyle|background|border|borderWidth|handles|_53|key|switch|alt|arrows|_34|_3c|_41|_44|cursor|_3b|_39|innerWidth|onKeyPress|outerHeight|_2f|_2d|setOptions|src|complete|fontSize||||hidden|visibility|_56|_57|index|length|while|window|match|filter|borderColor|borderColor2|solid|borderColor1|borderOpacity|for|null|_52|default|originalEvent|ctrlKey|shiftKey|onInit|setTimeout|onSelectStart|which|_47|_46|_43|_37|margin|_33|slice|innerHeight|_2b|_2a|jQuery|instance|new|removeData|each|load|img|readyState|overflow|keypress|keydown|on|unselectable|attr|not|chrome||webkit|opera|exec|msie|update|cancelSelection|setSelection|getSelection|getOptions|persistent|split|aspectRatio|dashed|outerOpacity|outerColor|selectionOpacity|selectionColor|selection|outer|imageHeight|imageWidth|parseInt|handle|corners|in|keyCode|imgareaselect|animated|instanceof|visible|preventDefault|autoHide|_3d|toggle|move|mouseout|fadeOut|auto|relative|getBoundingClientRect|jquery|maxHeight|maxWidth|minHeight|minWidth|pageY|pageX|userAgent|navigator|documentElement|div|round|min|max|abs'.split('|')));
(function($){$.extend($.fn,{validate:function(options){if(!this.length){if(options&&options.debug&&window.console){console.warn("Nothing selected, can't validate, returning nothing.");}
return;}
var validator=$.data(this[0],"validator");if(validator){return validator;}
this.attr("novalidate","novalidate");validator=new $.validator(options,this[0]);$.data(this[0],"validator",validator);if(validator.settings.onsubmit){this.validateDelegate(":submit","click",function(event){if(validator.settings.submitHandler){validator.submitButton=event.target;}
if($(event.target).hasClass("cancel")){validator.cancelSubmit=true;}
if($(event.target).attr("formnovalidate")!==undefined){validator.cancelSubmit=true;}});this.submit(function(event){if(validator.settings.debug){event.preventDefault();}
function handle(){var hidden;if(validator.settings.submitHandler){if(validator.submitButton){hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val($(validator.submitButton).val()).appendTo(validator.currentForm);}
validator.settings.submitHandler.call(validator,validator.currentForm,event);if(validator.submitButton){hidden.remove();}
return false;}
return true;}
if(validator.cancelSubmit){validator.cancelSubmit=false;return handle();}
if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false;}
return handle();}else{validator.focusInvalid();return false;}});}
return validator;},valid:function(){if($(this[0]).is("form")){return this.validate().form();}else{var valid=true;var validator=$(this[0].form).validate();this.each(function(){valid=valid&&validator.element(this);});return valid;}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value);});return result;},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,"validator").settings;var staticRules=settings.rules;var existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));delete existingRules.messages;staticRules[element.name]=existingRules;if(argument.messages){settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);}
break;case"remove":if(!argument){delete staticRules[element.name];return existingRules;}
var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method];});return filtered;}}
var data=$.validator.normalizeRules($.extend({},$.validator.classRules(element),$.validator.attributeRules(element),$.validator.dataRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data);}
return data;}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+$(a).val());},filled:function(a){return!!$.trim(""+$(a).val());},unchecked:function(a){return!$(a).prop("checked");}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init();};$.validator.format=function(source,params){if(arguments.length===1){return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args);};}
if(arguments.length>2&&params.constructor!==Array){params=$.makeArray(arguments).slice(1);}
if(params.constructor!==Array){params=[params];}
$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),function(){return n;});});return source;};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(element,event){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){if(this.settings.unhighlight){this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);}
this.addWrapper(this.errorsFor(element)).hide();}},onfocusout:function(element,event){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element);}},onkeyup:function(element,event){if(event.which===9&&this.elementValue(element)===""){return;}else if(element.name in this.submitted||element===this.lastElement){this.element(element);}},onclick:function(element,event){if(element.name in this.submitted){this.element(element);}
else if(element.parentNode.name in this.submitted){this.element(element.parentNode);}},highlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).addClass(errorClass).removeClass(validClass);}else{$(element).addClass(errorClass).removeClass(validClass);}},unhighlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).removeClass(errorClass).addClass(validClass);}else{$(element).removeClass(errorClass).addClass(validClass);}}},setDefaults:function(settings){$.extend($.validator.defaults,settings);},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=(this.groups={});$.each(this.settings.groups,function(key,value){if(typeof value==="string"){value=value.split(/\s/);}
$.each(value,function(index,name){groups[name]=key;});});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value);});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");if(validator.settings[eventType]){validator.settings[eventType].call(validator,this[0],event);}}
$(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, "+"[type='number'], [type='search'] ,[type='tel'], [type='url'], "+"[type='email'], [type='datetime'], [type='date'], [type='month'], "+"[type='week'], [type='time'], [type='datetime-local'], "+"[type='range'], [type='color'] ","focusin focusout keyup",delegate).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",delegate);if(this.settings.invalidHandler){$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler);}},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid()){$(this.currentForm).triggerHandler("invalid-form",[this]);}
this.showErrors();return this.valid();},checkForm:function(){this.prepareForm();for(var i=0,elements=(this.currentElements=this.elements());elements[i];i++){this.check(elements[i]);}
return this.valid();},element:function(element){element=this.validationTargetFor(this.clean(element));this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element)!==false;if(result){delete this.invalid[element.name];}else{this.invalid[element.name]=true;}
if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers);}
this.showErrors();return result;},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]});}
this.successList=$.grep(this.successList,function(element){return!(element.name in errors);});}
if(this.settings.showErrors){this.settings.showErrors.call(this,this.errorMap,this.errorList);}else{this.defaultShowErrors();}},resetForm:function(){if($.fn.resetForm){$(this.currentForm).resetForm();}
this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass).removeData("previousValue");},numberOfInvalids:function(){return this.objectLength(this.invalid);},objectLength:function(obj){var count=0;for(var i in obj){count++;}
return count;},hideErrors:function(){this.addWrapper(this.toHide).hide();},valid:function(){return this.size()===0;},size:function(){return this.errorList.length;},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin");}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name===lastActive.name;}).length===1&&lastActive;},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){if(!this.name&&validator.settings.debug&&window.console){console.error("%o has no name assigned",this);}
if(this.name in rulesCache||!validator.objectLength($(this).rules())){return false;}
rulesCache[this.name]=true;return true;});},clean:function(selector){return $(selector)[0];},errors:function(){var errorClass=this.settings.errorClass.replace(" ",".");return $(this.settings.errorElement+"."+errorClass,this.errorContext);},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([]);},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers);},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element);},elementValue:function(element){var type=$(element).attr("type"),val=$(element).val();if(type==="radio"||type==="checkbox"){return $("input[name='"+$(element).attr("name")+"']:checked").val();}
if(typeof val==="string"){return val.replace(/\r/g,"");}
return val;},check:function(element){element=this.validationTargetFor(this.clean(element));var rules=$(element).rules();var dependencyMismatch=false;var val=this.elementValue(element);var result;for(var method in rules){var rule={method:method,parameters:rules[method]};try{result=$.validator.methods[method].call(this,val,element,rule.parameters);if(result==="dependency-mismatch"){dependencyMismatch=true;continue;}
dependencyMismatch=false;if(result==="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return;}
if(!result){this.formatAndAdd(element,rule);return false;}}catch(e){if(this.settings.debug&&window.console){console.log("Exception occurred when checking element "+element.id+", check the '"+rule.method+"' method.",e);}
throw e;}}
if(dependencyMismatch){return;}
if(this.objectLength(rules)){this.successList.push(element);}
return true;},customDataMessage:function(element,method){return $(element).data("msg-"+method.toLowerCase())||(element.attributes&&$(element).attr("data-msg-"+method.toLowerCase()));},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor===String?m:m[method]);},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i];}}
return undefined;},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customDataMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>");},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message==="function"){message=message.call(this,rule.parameters,element);}else if(theregex.test(message)){message=$.validator.format(message.replace(theregex,"{$1}"),rule.parameters);}
this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message;},addWrapper:function(toToggle){if(this.settings.wrapper){toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));}
return toToggle;},defaultShowErrors:function(){var i,elements;for(i=0;this.errorList[i];i++){var error=this.errorList[i];if(this.settings.highlight){this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);}
this.showLabel(error.element,error.message);}
if(this.errorList.length){this.toShow=this.toShow.add(this.containers);}
if(this.settings.success){for(i=0;this.successList[i];i++){this.showLabel(this.successList[i]);}}
if(this.settings.unhighlight){for(i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);}}
this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show();},validElements:function(){return this.currentElements.not(this.invalidElements());},invalidElements:function(){return $(this.errorList).map(function(){return this.element;});},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass(this.settings.validClass).addClass(this.settings.errorClass);label.html(message);}else{label=$("<"+this.settings.errorElement+">").attr("for",this.idOrName(element)).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper){label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();}
if(!this.labelContainer.append(label).length){if(this.settings.errorPlacement){this.settings.errorPlacement(label,$(element));}else{label.insertAfter(element);}}}
if(!message&&this.settings.success){label.text("");if(typeof this.settings.success==="string"){label.addClass(this.settings.success);}else{this.settings.success(label,element);}}
this.toShow=this.toShow.add(label);},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr("for")===name;});},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name);},validationTargetFor:function(element){if(this.checkable(element)){element=this.findByName(element.name).not(this.settings.ignore)[0];}
return element;},checkable:function(element){return(/radio|checkbox/i).test(element.type);},findByName:function(name){return $(this.currentForm).find("[name='"+name+"']");},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element)){return this.findByName(element.name).filter(":checked").length;}}
return value.length;},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true;},dependTypes:{"boolean":function(param,element){return param;},"string":function(param,element){return!!$(param,element.form).length;},"function":function(param,element){return param(element);}},optional:function(element){var val=this.elementValue(element);return!$.validator.methods.required.call(this,val,element)&&"dependency-mismatch";},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true;}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0;}
delete this.pending[element.name];if(valid&&this.pendingRequest===0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false;}else if(!valid&&this.pendingRequest===0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false;}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")});}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},number:{number:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){if(className.constructor===String){this.classRuleSettings[className]=rules;}else{$.extend(this.classRuleSettings,className);}},classRules:function(element){var rules={};var classes=$(element).attr("class");if(classes){$.each(classes.split(" "),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this]);}});}
return rules;},attributeRules:function(element){var rules={};var $element=$(element);var type=$element[0].getAttribute("type");for(var method in $.validator.methods){var value;if(method==="required"){value=$element.get(0).getAttribute(method);if(value===""){value=true;}
value=!!value;}else{value=$element.attr(method);}
if(/min|max/.test(method)&&(type===null||/number|range|text/.test(type))){value=Number(value);}
if(value){rules[method]=value;}else if(type===method&&type!=='range'){rules[method]=true;}}
if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength;}
return rules;},dataRules:function(element){var method,value,rules={},$element=$(element);for(method in $.validator.methods){value=$element.data("rule-"+method.toLowerCase());if(value!==undefined){rules[method]=value;}}
return rules;},staticRules:function(element){var rules={};var validator=$.data(element.form,"validator");if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};}
return rules;},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return;}
if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break;}
if(keepRule){rules[prop]=val.param!==undefined?val.param:true;}else{delete rules[prop];}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter;});$.each(['minlength','maxlength'],function(){if(rules[this]){rules[this]=Number(rules[this]);}});$.each(['rangelength','range'],function(){var parts;if(rules[this]){if($.isArray(rules[this])){rules[this]=[Number(rules[this][0]),Number(rules[this][1])];}else if(typeof rules[this]==="string"){parts=rules[this].split(/[\s,]+/);rules[this]=[Number(parts[0]),Number(parts[1])];}}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max;}
if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength;}}
return rules;},normalizeRule:function(data){if(typeof data==="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true;});data=transformed;}
return data;},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!==undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name));}},methods:{required:function(value,element,param){if(!this.depend(param,element)){return"dependency-mismatch";}
if(element.nodeName.toLowerCase()==="select"){var val=$(element).val();return val&&val.length>0;}
if(this.checkable(element)){return this.getLength(value,element)>0;}
return $.trim(value).length>0;},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(value);},url:function(value,element){return this.optional(element)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value);},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value).toString());},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(value);},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value);},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value);},creditcard:function(value,element){if(this.optional(element)){return"dependency-mismatch";}
if(/[^0-9 \-]+/.test(value)){return false;}
var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9){nDigit-=9;}}
nCheck+=nDigit;bEven=!bEven;}
return(nCheck%10)===0;},minlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length>=param;},maxlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length<=param;},rangelength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||(length>=param[0]&&length<=param[1]);},min:function(value,element,param){return this.optional(element)||value>=param;},max:function(value,element,param){return this.optional(element)||value<=param;},range:function(value,element,param){return this.optional(element)||(value>=param[0]&&value<=param[1]);},equalTo:function(value,element,param){var target=$(param);if(this.settings.onfocusout){target.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid();});}
return value===target.val();},remote:function(value,element,param){if(this.optional(element)){return"dependency-mismatch";}
var previous=this.previousValue(element);if(!this.settings.messages[element.name]){this.settings.messages[element.name]={};}
previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param==="string"&&{url:param}||param;if(previous.old===value){return previous.valid;}
previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===true||response==="true";if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);delete validator.invalid[element.name];validator.showErrors();}else{var errors={};var message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.invalid[element.name]=true;validator.showErrors(errors);}
previous.valid=valid;validator.stopRequest(element,valid);}},param));return"pending";}}});$.format=$.validator.format;}(jQuery));(function($){var pendingRequests={};if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=xhr;}});}else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort();}
pendingRequests[port]=ajax.apply(this,arguments);return pendingRequests[port];}
return ajax.apply(this,arguments);};}}(jQuery));(function($){$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments);}});}});}(jQuery));;
prevID='';cropImgSize={};resultImgSize={};var imgCrop={init:function(){$('.J-upload-img-btn').unbind('click').click(function(){var error_obj=$(this).parent().parent().find('.J-tip');check.removeError(error_obj,$(this));$('#'+$(this).data('target')).click();})},change:function(o){var self=this;var imgModalObj=$('.J-crop-modal');prevID=$(o).data('previd');resultImgSize={w:$(o).data('width'),h:$(o).data('height'),r:$(o).data('width')/$(o).data('height'),aspectRatio:$(o).data('width')+':'+$(o).data('height')};console.log(resultImgSize);imgModalObj.find('.J-canvas').attr('width',resultImgSize.w).attr('height',resultImgSize.h);imgModalObj.find('.preview-box').css('height',150/resultImgSize.r);console.log(o.value);if(!o.value){return;}
var isIE=navigator.userAgent.indexOf('MSIE')>=0;if(!o.value.match(/.jpg|.gif|.png|.bmp/i)){alert('图片格式无效！');return false;}
if(isIE){imgModalObj.find('.image-box img').attr('src',o.value);imgModalObj.find('.preview-box img').attr('src',o.value);}
if(!isIE){var file=o.files[0];var reader=new FileReader();reader.onload=function(){var img=new Image();img.src=reader.result;self.setCropImgSize(img.width,img.height);imgModalObj.find('.image-box img').attr('src',reader.result);imgModalObj.find('.preview-box img').attr('src',reader.result);};reader.readAsDataURL(file);}
imgModalObj.modal('show');imgModalObj.find('.image-box img').imgAreaSelect({aspectRatio:resultImgSize.aspectRatio,handles:true,fadeSpeed:200,onSelectChange:this.prev});self.resetSelector(imgModalObj.find('.image-box img'),150,150/resultImgSize.r);$(o).replaceWith('<input style="display:none" type="file" class="J-img-input" id="'
+$(o).attr('id')
+'" onchange="imgCrop.change(this)" data-width="'
+$(o).data('width')
+'" data-height="'
+$(o).data('height')
+'" data-previd="'
+$(o).data('previd')
+'">');self.init();},resetSelector:function(img,select_w,select_h){var isMac=navigator.userAgent.indexOf('Mac OS X')>0;var time=isMac?500:1000;setTimeout(function(){var imgW=img.width();var imgH=img.height();var ratio=select_w/select_h;if(imgW<select_w){select_w=imgW;select_h=select_w/ratio;}
if(imgH<select_h){select_h=imgH;select_w=select_h*ratio;}
var X1=(imgW-select_w)/2,Y1=(imgH-select_h)/2,X2=X1+select_w,Y2=Y1+select_h;img.imgAreaSelect({x1:X1,y1:Y1,x2:X2,y2:Y2});cropImgSize={'x1':X1,'y1':Y1,'w':select_w,'h':select_h};},time)},setCropImgSize:function(w,h){var cropModalObj=$('.J-crop-modal');if(w>h){cropModalObj.find('.image-box img').css('width','400px').css('height','auto');}else{cropModalObj.find('.image-box img').css('height','400px').css('width','auto');}},prev:function(img,selection){if(!selection.width||!selection.height)
return;var scaleX=150/selection.width;var scaleY=(150/resultImgSize.r)/selection.height;$('.J-crop-modal .preview-box img').css({width:Math.round(scaleX*img.width),height:Math.round(scaleY*img.height),marginLeft:-Math.round(scaleX*selection.x1),marginTop:-Math.round(scaleY*selection.y1)});cropImgSize={'x1':selection.x1,'y1':selection.y1,'w':selection.width,'h':selection.height};},confirm:function(){var size=cropImgSize;var cropModalObj=$(".J-crop-modal");var primary_width=cropModalObj.find(".image-box img").width();var sourseImg=new Image();sourseImg.src=cropModalObj.find(".image-box img").attr('src');var R=sourseImg.width/primary_width;var canvas=cropModalObj.find(".J-canvas")[0];var context=canvas.getContext("2d");context.drawImage(sourseImg,size.x1*R,size.y1*R,size.w*R,size.h*R,0,0,canvas.width,canvas.height);$('#'+prevID).html('').append("<img src='"+canvas.toDataURL('image/jpeg',0.8)+"'/>");this.cancel();console.log('crop success');},cancel:function(){$(".J-crop-modal").modal('hide');this.clearCrop();},clearCrop:function(){$('.imgareaselect-outer').hide();$('.imgareaselect-handle').parent().hide();this.init();}};;
$(function(){initAccountEvents();var href=location.href;if(href.match('index')){$('.J-center-li a').click();}});function initAccountEvents(){if(accountEvents.length>0){for(var i in accountEvents){try{accountEvents[i]();}catch(e){console.log('accountEvents['+i+']',e);}}}}
function initInvested(){cancelOrder();refundOrder();}
function cancelOrder(){$('.J-cancel-order').click(function(){var id=$(this).data('id');$('.J-cancelPay-confirm-btn').data('id',id);$('#cancelPayDialog').modal('show');});$('.J-cancelPay-confirm-btn').click(function(){var id=$(this).data('id');API.post('order_cancel',{id:id},function(result){$('#cancelPayDialog').modal('hide');setTimeout(function(){$('.J-continue-'+id).css('display','none');$('.J-cancel-'+id).replaceWith('<a href="javascript:void(0);" class="btn C-pray-btn C-J-static-waiting-btn">已取消支付</a>');alertImg(result.message);},500);})});$('.J-cancelPay-cancel-btn').click(function(){$('#cancelPayDialog').modal('hide');})}
function refundOrder(){$('.J-refund-order').click(function(){var id=$(this).data('id');$('#myReasonModel').modal('show').find('.C-J-confirm').data('id',id);});$('.J-refund-reason  .status-flag').click(function(){$('.J-refund-reason .status-flag').removeClass('select');var is_other=parseInt($(this).data('value'))==3;if(is_other){$('.J-other-reason-input').attr('disabled',false).focus();}else{$('.J-other-reason-input').attr('disabled',true);}
$(this).addClass('select');});$('#myReasonModel .C-J-confirm').click(function(){var refundReason={'0':'项目风险高，回报低','1':'投资期限太长','2':'短期急需资金周转','3':$('.J-other-reason-input').val()};var myReasonObj=$('#myReasonModel');var id=$(this).data('id');var reason=refundReason[myReasonObj.find('.status-flag.select').data('value')];if(!reason.length){myReasonObj.find('.error-box').html('*请填写您要撤资的原因').css('display','block');setTimeout(function(){myReasonObj.find('.error-box').css('display','none');},1500);return;}
myReasonObj.find('.error-box').css('display','none');var post={id:id,reason:reason};API.post('order_refund',post,function(result){myReasonObj.modal('hide');setTimeout(function(){alertImg(result.message);$('.J-refund-order').replaceWith('<a href="javascript:void(0);" class="btn C-J-static-waiting-btn">已撤资，待审核</a>');},500)})})}
function initNewsPage(){$('.J-unread').click(function(){var that=this;API.post('message_read',{id:$(that).data('id')},function(result){if(result.error==0){$(that).find('.unread').remove();$(that).removeClass('unread-li').removeClass('J-unread');var preNum=parseInt($('.J-news-num').html());var num=preNum-1;if(num){$('.J-news-num').html(num);}
if(!num){$('.J-news-num').css('display','none');}}else{alertImg(result.message);}});});$('.J-pop-page').click(function(){var text=$(this).text();if(text=='跳转'){$('.J-pop-to-box').slideDown('fast');$('.J-pop-to-box input').focus();$(this).text('取消');}
if(text=='取消'){$('.J-pop-to-box').slideUp('fast');$(this).text('跳转');$('.J-pop-to-box input').val('');}});$('.J-page-input-btn').click(function(){var page_input=$('.J-page-input').val();if(!checkPositiveInt(page_input)){alertImg('请输入大于0的页码');}
location.href='/user/message/page/'+page_input;})}
function initHotCity(){var selectIds=$('#city-input').data('ids');if(selectIds){selectIds=selectIds.toString().split(',');}
API.post('region',{pid:'hot'},function(result){if(result.error==0){var cities=JSON.parse(result.message);var tpl_1=tpl('hotCityModal');var tpl_2=tpl('cityShowModal');for(var i=0;i<cities.length;i++){var tplHtml_1=tpl_1({name:cities[i].name,code:cities[i].code,id:cities[i].id});$('.J-select-city-box .J-city').append(tplHtml_1);if(selectIds){for(var j=0;j<selectIds.length;j++){if(cities[i].id==selectIds[j]){$('.J-select-city-box .J-city input').eq(i).addClass('select');var tplHtml_2=tpl_2({val:cities[i].name,id:selectIds[j]});$('#city-input').before(tplHtml_2);}}
initCityDelete();}}
initCitySelect();}else{alertImg(result.message);}})}
function initCityInput(){$('#city-input').click(function(){$('#citySelectModal').modal('show');removeError($(this));});initCitySelect();$('.J-select-city-box .J-confirm').click(function(){var has_select_inputs=$('.J-select-city-box .J-city').find('.select');$('.J-focus-city').find('.J-city').remove();var ids=[];for(var i=0;i<has_select_inputs.length;i++){var val=has_select_inputs.eq(i).val();var tplHtml=tpl('cityShowModal',{val:val,id:has_select_inputs.eq(i).data('id')});ids.push(has_select_inputs.eq(i).data('id'));$('#city-input').before(tplHtml);}
showLoading();API.post('user_feed_region',{id:ids.join(',')},function(result){if(result.error==0){initCityDelete();$('#citySelectModal').modal('hide');hideLoading();}else{hideLoading();alertImg(result.message);}})});}
function initCitySelect(){$('.J-select-city-box .J-city input').unbind('click').click(function(){var is_selected=$(this).hasClass('select');if(is_selected){$(this).removeClass('select');}
if(!is_selected){$(this).addClass('select');}});}
function initCityDelete(){$('.J-focus-city .close').unbind('click').click(function(){var id=$(this).data('id');var that=this;var post={id:id,unfeed:1,type:'region'};API.post('user_feed',post,function(result){if(result.error==0){$(that).parent().remove();var city_inputs=$('.J-select-city-box .J-city').find('input');for(var i=0;i<city_inputs.length;i++){if(city_inputs.eq(i).data('id')==id){city_inputs.eq(i).removeClass('select');}}}else{alertImg(result.message);}});})}
function initFieldSelect(){$('.J-focus-fields .status-flag').click(function(){var selectField=$('.J-focus-fields .select');var is_select=$(this).hasClass('select');if(!is_select&&selectField.length>4){alertImg('不要贪心，您关注的够多了');return;}
var unfeed=is_select?1:'';var post={id:$(this).data('id'),type:'area',unfeed:unfeed};var that=this;removeError($('.J-focus-fields'));API.post('user_feed',post,function(result){if(result.error==0){if(is_select){$(that).removeClass('select')}else{$(that).addClass('select');}}else{alertImg(result.message);}});});}
function setNewsStatus(){$('#accountNews .J-mark-all-news').click(function(){var newsUnread=$('.J-unread');var ids=[];if(!newsUnread[0]){alertImg('已全部标记为已读');return;}
for(var i=0;i<newsUnread.length;i++){ids.push(newsUnread.eq(i).data('id'));}
var post={id:ids.join(',')};var newNum=parseInt($('.J-news-num').html());showLoading();API.post('message_read',post,function(result){hideLoading();if(result.error==0){$('#accountNews .unread').remove();$('.J-unread').removeClass('unread-li').removeClass('J-unread');if(newNum>ids.length){$('.J-news-num').html(newNum-ids.length);}else{$('.J-news-num').hide();}
alertImg('全部标记成功');}else{alertImg(result.message);}});})}
function initBasicInfo(){initEditBtn();initEditCancelBtn();initEditSaveBtn();}
function initCropImage(){$('.J-upload-logo').unbind('click').click(function(){var target=$(this).data('target');$('#'+target).click();});}
function initEditBtn(){$('.J-is-invested .J-edit-btn').unbind('click').click(function(){$('.J-is-invested .show-box').css('display','none');$('.J-is-invested .edit-box').css('display','block');})}
function initEditCancelBtn(){$('.J-is-invested .C-J-cancel-btn').unbind('click').click(function(){$('.J-is-invested .edit-box').css('display','none');$('.J-is-invested .show-box').css('display','block');$("body").animate({scrollTop:0},100);})}
function initEditSaveBtn(){$('.J-is-invested .C-J-save-btn').unbind('click').click(function(){var investorData=judgeUserEditData();if(investorData.status){showLoading();API.post('certificate',investorData.data,function(result){if(result.error==0){location.reload(true);}else{hideLoading();alertImg(result.message);}})}})}
function judgeUserEditData(){var realNameObj=$('.J-is-invested .edit-box .J-real-name'),cityObj=$('.J-is-invested .edit-box .J-region'),companyObj=$('.J-is-invested .edit-box .J-company'),positionObj=$('.J-is-invested .edit-box .J-position'),focusCityObj=$('.J-is-invested .edit-box .J-focus-city'),focusFieldsObj=$('.J-is-invested .edit-box .J-focus-fields');var name=realNameObj.val(),city=cityObj.val(),company=companyObj.val(),position=positionObj.val(),img_src=$('#userImgPrev img').attr('src'),focus_cities=focusCityObj.find('.J-city'),focus_fields=focusFieldsObj.find('.select');var investorData={'status':false,'data':[]};if(!name||!judgeOnlyChineseOrEnlish(realNameObj[0])){setError(realNameObj,'*请填写姓名');realNameObj.focus();return investorData;}else{removeError(realNameObj);}
if(!city){setError(cityObj,'*请填写您的所在城市');cityObj.focus();return investorData;}else{removeError(cityObj);}
if(!company){setError(companyObj,'*请填写您的公司');companyObj.focus();return investorData;}else{removeError(companyObj);}
if(!position){setError(positionObj,'*请填写您的公司');positionObj.focus();return investorData;}else{removeError(positionObj);}
if(!focus_cities.length){setError($('#city-input'),'*请选择您关注的城市');$('#city-input').focus();focusCityObj.find('.error-tip').css({"margin-top":$('.J-focus-city').height()-10});return investorData;}else{removeError($('#city-input'));}
if(!focus_fields.length){setError(focusFieldsObj,'*请选择您关注的领域');focusFieldsObj.focus();focusFieldsObj.parent().find('.error-tip').css({"margin-top":focusFieldsObj.height(),"margin-left":'80px'});return investorData;}else{removeError(focusFieldsObj);}
$('#userAvatarInput').val(img_src);var userData=$('#investorEditorBox').serializeArray();investorData.data={};for(var i in userData){investorData.data[userData[i].name]=userData[i].value;}
investorData.status=true;return investorData;}
$.validator.addMethod("phone",function(value,element,params){var phoneReg=/^1[3|4|5|7|8]\d{9}$/;return phoneReg.test(value);},"请输入正确的手机号码");$.validator.addMethod("passwordR",function(value,element,params){return value.length>5&&value.length<17;},"请输入6-16位的密码");jQuery.extend(jQuery.validator.messages,{required:"不能为空",email:"请输入正确格式的电子邮件",equalTo:"两次密码输入不一致"});var security={init:function(){this.setLevelStatus();this.initEvent();initFetchCheckCode2();this.validate();},validate:function(){$('.J-email-edit-box form').validate({rules:{"email":{required:true,email:true},"regcode":{required:true}}});$('.J-phone-edit-box form').validate({rules:{"phone":{required:true,phone:true},"regcode":{required:true}}});$('.J-password-edit-box form').validate({rules:{"old-password":{required:true},"password":{required:true,passwordR:true},"password-confirm":{required:true,equalTo:'.J-password-form .J-pwd'}}});},initEvent:function(){var self=this;initPwdCapsLock();$('.J-fix-btn').click(function(){var type=$(this).data('type'),status=$(this).data('status'),source=$(this).data('source'),sourceStatus='display:none',sourceName='',sourceShow='';var securityModalObj=$('#securityModel');if(type=='password'){$('.J-'+type+'-edit-box').slideDown('fast').find('.J-pwd-old').focus();$(this).hide();}else{if(status=='y'){sourceStatus='display:block';sourceName=type=='phone'?'手机':'邮箱';sourceShow=type=='phone'?$('.J-phone-show').html():$('.J-email-show').html();}
var data={sourceName:sourceName,sourceShow:sourceShow,source:source,type:type,sourceStatus:sourceStatus};var securityCheckTpl=tpl('securityCheckTpl',data);securityModalObj.find('.modal-content').html(securityCheckTpl);securityModalObj.unbind('shown.bs.modal').on('shown.bs.modal',function(){self.initSecurityModalEvent();var isHasCodeCheck=$(this).find('.account-box').css('display')=='block';if(isHasCodeCheck){$(this).find('.J-check-code-btn').click();$(this).find('.J-check-code').focus();}else{$(this).find('.J-pwd').focus();}}).modal('show');}});$('.J-security .J-cancel-btn').click(function(){var type=$(this).data('type');$('.J-'+type+'-edit-box').slideUp('fast');$('.J-fix-btn[data-type='+type+']').show();});$('.J-security .J-confirm-btn').click(function(){var type=$(this).data('type');$('.J-'+type+'-form').submit(function(){return false;}).submit();if($('.J-'+type+'-form input.error').length){return;}
if(type=='email'){self.fixEmail();}
if(type=='phone'){self.fixPhone();}
if(type=='password'){self.fixPassword();}});$('.J-security .J-pwd-old').on('change',function(){var that=this;var post={password:$(this).val()};API.post('is_password',post,function(result){if(result.error==0){$(that).parent().removeClass('unpass').addClass('pass');}else{$(that).parent().removeClass('pass').addClass('unpass');$(that).parent().find('.warning').html('密码错误').show();setTimeout(function(){$(that).parent().find('.warning').hide();},2000)}});});$('.J-security input').bind('keypress',function(event){if(event.keyCode=="13"){$('.J-security input').parent().parent().find('.J-confirm-btn').click();}});},setLevelStatus:function(){var level_1=$('.level-1');var levelDescObj=$('.J-level-desc'),levelLineObj=$('.J-level-line');if(level_1.length==2){levelDescObj.html('中');levelLineObj.css('width','50%').addClass('level-0');}
if(level_1.length==3){levelDescObj.html('高');levelLineObj.css('width','100%').removeClass('level-0');}},initSecurityModalEvent:function(){initFetchCheckCode2();initPwdCapsLock();$('#securityCheck').unbind('validate').validate({rules:{"loginPassword":{required:true},"regcode":{required:true}}});var securityModalObj=$('#securityModel');securityModalObj.find('.J-confirm').unbind('click').click(function(){var type=$(this).data('type'),formObj=$('#securityCheck');formObj.submit(function(){return false;}).submit();var isError=formObj.find('input.error').length;if(isError){return;}
if(!isError){var password=securityModalObj.find('.J-pwd').val(),regcode=securityModalObj.find('.J-check-code').val();var post={type:type,password:password,regcode:regcode};API.post('is_password',post,function(result){if(result.error==0){var message=result.message;if(type=='email'){$('.J-email-form').find('.J-md5-pass').val(message);}else if(type=='phone'){$('.J-phone-form').find('.J-md5-pass').val(message);}
securityModalObj.modal('hide');$('.J-'+type+'-edit-box').slideDown('fast');}else{securityModalObj.find('.error-box').text(result.message).show();setTimeout(function(){securityModalObj.find('.error-box').hide();},2500)}});}});securityModalObj.find('input').bind('keypress',function(event){if(event.keyCode=="13"){securityModalObj.find('.J-confirm').click();}});},fixEmail:function(){var emailObj=$('.J-email-form');var post={email:emailObj.find('#securityEmailInput').val(),regcode:emailObj.find('.J-check-code').val(),md5_pass:emailObj.find('.J-md5-pass').val(),};API.post('update_email',post,function(result){if(result.error==0){setTimeout(function(){alertImg('邮箱已修改成功，请重新登录');setTimeout(function(){location.href='/user/login/';},1000);},1000);}else{emailObj.find('.error-box').html(result.message).show();setTimeout(function(){emailObj.find('.error-box').hide();},2500)}});},fixPhone:function(){var phoneObj=$('.J-phone-form');var post={phone:phoneObj.find('#securityPhoneInput').val(),regcode:phoneObj.find('.J-check-code').val(),md5_pass:phoneObj.find('.J-md5-pass').val(),};API.post('update_phone',post,function(result){if(result.error==0){alertImg('手机已修改成功，请重新登录');setTimeout(function(){location.href='/user/login/';},2500);}else{phoneObj.find('.error-box').html(result.message).show();setTimeout(function(){phoneObj.find('.error-box').hide();},2500)}});},fixPassword:function(){var passwordObj=$('.J-password-form');var post={password_new:passwordObj.find('.J-pwd').val(),password2:passwordObj.find('.J-pwd-confirm').val(),password:passwordObj.find('.J-pwd-old').val()};API.post('password',post,function(result){if(result.error==0){alertImg('密码修改成功，请用新密码重新登录');setTimeout(function(){location.href='/user/login/';},2500);}else{passwordObj.find('.error-box').html(result.message).show();setTimeout(function(){passwordObj.find('.error-box').hide();},2500)}});},checkPwdMode:function(o){var pwd=$(o).val();var levelBoxObj=$('.J-pwd-level-box');if(pwd.length<6||pwd.length>16){levelBoxObj.hide();return;}
var level=check_strength(pwd);var content="";switch(level){case 0:content="弱";break;case 1:content="中";break;case 2:content="高";break;}
levelBoxObj.show().find('.J-level-desc').html(content);levelBoxObj.find('.level').removeClass('level-0').removeClass('level-1').removeClass('level-2').addClass('level-'+level);}};function char_type(char)
{if(char>=48&&char<=57)
{return 1;}
if(char>=65&&char<=90)
{return 2;}
if(char>=97&&char<=122)
{return 4;}
return 8;}
function bit_count(n)
{var c=0;while(n>0)
{if((n&1)==1)
{++c;}
n=n>>1;}
return c;}
function total_mode(str){var len=str.length;var mode=0;for(var i=0;i<len;i++){mode=mode|char_type(str[i].charCodeAt());};return bit_count(mode);}
function check_strength(str){var len=str.length;var mode=total_mode(str);if(mode==1)
{return 0;}
if(mode==2||(len>6&&len<=8))
{return 1;}
if(len>8&&(mode==3||mode==4))
{return 2;}
return 0;}
function initFetchCheckCode2(){$('.J-check-code-btn').unbind('click').click(function(){var type=$(this).data('type');var page=$(this).data('page');var post={type:type,source:page=='securityModel'?'':$('#'+$(this).data('target')).val()},eventObject=this;API.post('account_safecode',post,function(result){if(result.error==0){if(type=='phone'){showAlertInfo('验证码已发送至您的手机，请及时查收。',page=='securityModel'?$('#securityModel .J-alert'):'');}
if(type=='email'){showAlertInfo('验证码已发送至您的邮箱，请及时查收。');}
$('.error-box').css('display','none');settime($(eventObject));}
if(result.error==1){if(page=='phone-register'){$('#phone').find('.error-box').html(result.message).css('display','block');return;}
if(page=='email-register'){$('#email').find('.error-box').html(result.message).css('display','block');return;}
if(page=='securityModel'){$('#securityModel').find('.error-box').html(result.message).show();setTimeout(function(){$('#securityModel').find('.error-box').hide();},2500);return;}
alertImg(result.message);}});});};